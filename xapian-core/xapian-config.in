#! /bin/sh
# @configure_input@

prefix="@prefix@"
exec_prefix="@exec_prefix@"
libdir="@libdir@"
includedir="@includedir@"

usage()
{
    cat <<EOF
Usage: xapian-config [OPTION]...

Known values for OPTION are:

  --libs	print library linking information
  --ltlibs	print library linking information for linking with GNU libtool
  --cxxflags	print pre-processor and compiler flags
  --help	display this help and exit successfully
  --version	output version information
EOF

    exit $1
}

if test 0 = "$#"; then
    usage 1
fi

builddir="`echo $0|sed 's![^/]*$!!'`"
xo_lib_xapian=no

while test 0 != "$#"; do
    case "$1" in
    -*=*) optarg="`echo \"$1\" | sed 's/[-_a-zA-Z0-9]*=//'`" ;;
    *) optarg= ;;
    esac

    case "$1" in
    --version)
	echo "xapian @VERSION@"
	exit 0
	;;

    --from-xo-lib-xapian)
	# Top Secret option which allows us to give a more helpful error
	# message if we're asked to link with an uninstalled libxapian
	# and libtool isn't in use.
	xo_lib_xapian=yes
	;;

    --help)
	usage 0
	;;

    --cxxflags)
	inc=
    	# check if this is an uninstalled xapian-config
   	if test -n "$builddir" -a -f "${builddir}Makefile" ; then
	    inc=
	    # version.h is generated by configure, so we need builddir too
	    test "@abs_srcdir@" != "@abs_builddir@" && inc="-I@abs_builddir@/include "
	    inc="$inc-I@abs_srcdir@/include -I@abs_srcdir@/extra"
	else	    
	    case "$includedir" in
	    /usr/include|/usr/include/c++) ;;
	    *) inc="-I$includedir" ;;
	    esac
	fi
	if test -n "@STLPORT_CXXFLAGS@" ; then
	    echo "@STLPORT_CXXFLAGS@ $inc"
	else
	    echo "$inc"
	fi
	;;

    --libs)
    	# check if this is an uninstalled xapian-config
   	if test -n "$builddir" -a -f "${builddir}Makefile" ; then
	    if test no = "$xo_lib_xapian" ; then
		echo "$0: Use libtool and \`xapian-config --ltlibs' to link with an uninstalled libxapian." 1>&2
	    else
		echo "$0: Add AC_PROG_LIBTOOL to your configure.in to link with an uninstalled libxapian." 1>&2
	    fi
	    exit 1
	fi
	F=
	test -n "@ldflags@" && F="@ldflags@ "
	L=
	test /usr/lib != "$libdir" && L="-L$libdir "
	D=
	eval `grep ^dependency_libs= "$libdir/libxapianqueryparser.la"`
	test -n "$dependency_libs" && D=" $dependency_libs"
	eval `grep ^dependency_libs= "$libdir/libxapian.la"`
	test -n "$dependency_libs" && D="$D $dependency_libs"
	echo "$F$L-lxapianqueryparser -lxapian$D"
	;;

    --ltlibs)
	F=
	test -n "@ldflags@" && F="@ldflags@ "
    	# check if this is an uninstalled xapian-config
   	if test -n "$builddir" -a -f "${builddir}Makefile" ; then
	    # don't check if libxapian.la exists yet - it won't unless
	    # the xapian-core tree has been built!
	    echo "$F${builddir}extra/libxapianqueryparser.la ${builddir}libxapian.la"
	    exit 0
	fi

	if test -f "$libdir/libxapian.la"; then
	    echo "$F$libdir/libxapianqueryparser.la $libdir/libxapian.la"
	    exit 0
	fi

	echo "$0: Can't find libxapian.la to link against." 1>&2
	exit 1
	;;

    *)
	usage 1 1>&2
	exit 1
	;;
    esac
    shift
done
exit 0
